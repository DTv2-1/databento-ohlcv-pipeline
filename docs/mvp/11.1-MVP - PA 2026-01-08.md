iteration: 2026-01-09.6 
author: jk
reviewers: Pete (primary)

___
# **PA (Tradovate) MVP**
## 0) Authority + Non-Negotiables

### 0.1 Dev Packet Checklist — What the PA MVP dev must have (and what each item is for)

**A) Authority / Constraints (binding)**
1. **Authoritative Architecture (2026-01-05)** — system intent + allowed module relationships
2. **ADR Collection (2026-01-05)** — non-negotiable decisions + invariants
3. **MIC Template (frozen v1)** — required contract structure + MUST/MUST NOT boundaries
4. **Coding Consistency & Style Guide (pinned version/date)** — merge standards (naming, logging, testing, error handling)

**B) PA-Specific Build Inputs (binding for MVP)**  
5) **PA MVP Module Spec (current draft)** — behavioral requirements + boundaries (MUST/MUST NOT)  
6) **PA MIC (current draft)** — allowed peers + message shapes + seq/order + failure/backpressure expectations  
7) **PA MVP Decisions doc (current)** — explicit decisions + open blockers (DISCOVERY REQUIRED list)

**C) Execution / Validation (to prevent “done = vibes”)**  
8) **Acceptance tests / done criteria** — connectivity, market feed forwarding, execution command loop, failure behavior  
9) **Discovery checklist deliverable** — Tradovate feed types/intervals/IDs, reconnect semantics, rate limits, identifiers  
10) **Runbook-lite requirement** — how to run locally/staging, how to trigger reconnect tests, where logs/artifacts go

**D) Required artifacts from dev (deliverables)**  
11) **PA connector implementation + config/secrets handling** (no hardcoded creds)  
12) **Test harness/mocks** (where feasible) + evidence of acceptance tests passing  
13) **Discovery report** with concrete findings (screenshots/links/notes) and explicit recommendations where choices are needed

### 0.2 Non-negotiable invariants (system-wide)
- **No invention:** if it’s not in Architecture/ADR/MIC, it becomes a blocking question or “DISCOVERY REQUIRED”.
- **U is the sole BarStream writer.**
- **EventStream schema/location is canonical; LIVE writer = U; SIM writer = Paper; REPLAY is read-only.**
- **SL→R→OE is the only intent path.** (No strategy module talks to PA; only OE does. See Execution Path in 1.2 and 7.4 D for reference)
- **Backpressure (PA scope):** PA may drop/summarize **telemetry** first, but it **MUST NOT silently drop platform facts** (market/execution/account events) without escalating **PA_DEGRADED/PA_DOWN** and triggering a trading halt via OE when canonical capture is at risk. Canonical persistence remains U/Paper’s job.
	- PA must fail closed: if it cannot reliably forward platform facts to U, it must escalate and halt trading rather than continue blind 
- **PA MUST be behaviorally dumb:** it may map fields, add required metadata (`mode`, `source`), and attach correlation IDs, but it **MUST NOT** compute, infer, filter for strategy meaning, perform or apply any math outside of that strictly required to capture metadata, or generate derived series.

---

## 1) PA MVP: What we are building (and what we are NOT)

### 1.1 Module name
**Platform Adapter (PA)** — **Tradovate implementation** (MVP)

### 1.2 Layer / position in dataflow (authoritative)
- Market ingress: **Tradovate → PA → U → Paper → OE → Sig → …**
- Execution command path: **OE → PA → Tradovate**
- PA is **swappable by platform** (Tradovate vs IBKR vs Ninja vs …). Swappability is a design goal; MVP is Tradovate.

### 1.3 MVP goals
**MUST deliver:**
- Reliable **market data ingestion** from Tradovate into U (raw-as-possible; no fabricated bars).
- Reliable **execution/account event ingestion** from Tradovate into U (for canonical EventStream persistence).
- Reliable **order intent execution** from OE to Tradovate, with **receipt-ack** / immediate-failure response on the command call.
- A **discovery report** that answers the unknowns that impact canonical stream definitions (bar intervals, seq IDs, reconnect semantics, etc.)

**MUST NOT do:**
- Write BarStream or EventStream to disk (U/Paper own that).
- Generate signals, indicators, trigger zones, or any strategy math.
- Create side-channels that bypass U→Paper→OE ingestion rules for platform facts.
- “De-aggregate” 1m bars into 1s bars (fabrication).
- Change canonical schemas without an explicit architecture/ADR update.

---

## 2) Authoritative Dataflow (PA-specific)

### 2.1 PA’s external interfaces
- **External (platform side):** Tradovate APIs (market data + trading + account)
- **Internal (system side):**
  - **To U:** all platform facts (market data + execution/account/compliance events), raw or minimally normalized
  - **From OE:** execution intents (create/modify/cancel/flatten/kill)
  - **To OE:** **command receipt acknowledgment only** (request accepted for processing vs immediate failure, plus platform request id if available)  
    > Execution outcomes (accept/reject/fill/position changes) are **facts** and MUST flow **PA → U → Paper → OE**.

### 2.2 High-level flow (runtime)
1) PA connects + authenticates to Tradovate (**DISCOVERY REQUIRED**)
2) PA subscribes to configured instruments / feeds
3) PA forwards inbound market updates to U
4) PA receives execution intents from OE, translates to Tradovate calls, and returns **receipt-ack** (or immediate failure)
5) PA listens for platform execution/account events and forwards them to **U** (canonical EventStream persistence), which are then available to **Paper → OE**

---

## 3) PA Interfaces (Module Spec level)

> **Transport is intentionally not prescribed in this MVP spec.**  
> The dev must propose a transport (e.g., WS/gRPC/queue) that satisfies the **Module Interface Contract (MIC)** — i.e., the required message shapes, allowed peers, ordering/gap rules, and failure/backpressure behavior defined for this module.  
> If a transport choice would change architecture or schemas, mark it **DISCOVERY REQUIRED** and escalate.

### 3.1 Inputs (into PA)
**From Config:**
- Tradovate credentials / auth method (**DISCOVERY REQUIRED** for exact mechanism)
- Environment endpoints (demo/live)
- Instrument list (symbols/contracts)
- Desired timeframes (1s, 15s, 30s, 1m, etc. as defined by config module)
- Mode: LIVE / SIM / REPLAY (as toggle is set in config module)
	- In **SIM**, PA may provide **market ingress only** (no command acceptance); in **REPLAY**, PA is disabled

**From OE in LIVE mode (authoritative intent source):**
- Execution intents only:
  - submit order
  - cancel/replace
  - flatten
  - kill switch / halt trading signal (if routed through OE)

**From U / System Control (optional):**
- resubscribe/reset signals (**DISCOVERY REQUIRED**: confirm whether these exist as real messages vs operator actions)

**Order Placement Payload (Tradovate request body)**
- Order Placement (Platform Request Body): required fields forwarded by PA when executing OE SubmitOrder intent.
```
// OE → PA → Tradovate (order placement request body; platform-facing)
// NOTE: This is not a canonical EventStream record. Execution facts still flow PA → U → Paper → OE.

{
  "accountId": "YOUR_ACCOUNT_ID",
  "accountSpec": "YOUR_USER_NAME",
  "symbol": "NQH4",
  "action": "Buy",
  "orderQty": 1,
  "orderType": "Market",
  "isAutomated": true
}
```

### 3.2 Outputs (from PA)
**To U (market + events ingress):**
- Raw market bars (if provided by Tradovate) OR raw ticks (if bars not available), forwarded as received.
- Raw platform facts/events, including (as received):
  - orders / fills / rejects
  - account snapshots / compliance snapshots (if available)
  - **order lifecycle outcomes** (accept/reject/fill/position changes)
  - **flatten/kill outcomes** (if available)

**To OE (command loop only):**
- **Command receipt acknowledgment** (synchronous response to OE request):
  - success/failure (e.g., “request accepted for processing” vs “failed immediately”)
  - platform request id / correlation id if available
- **Immediate failures** that prevent the command from being sent/processed at all (auth down, transport down, validation fail)
  > OE must treat PA’s receipt-ack as *not a fact of execution*. Execution facts arrive via **U → Paper → OE**.

---

## 4) Hard MUST / MUST NOT boundaries (PA)

### 4.1 Data integrity boundaries
- PA **MUST NOT fabricate** market bars.
- PA **MUST NOT create synthetic lower timeframe bars** from higher timeframe bars.
- PA **MUST forward ticks/bars in arrival order** as provided by the platform (best effort; document any platform reorder behavior).

### 4.2 Canonical stream boundaries
- PA **MUST NOT write** BarStream or EventStream to canonical storage.
- PA **MUST emit platform facts to U** (market + execution/account/compliance) so U can populate canonical fields:
  - `mode` (LIVE/SIM)
  - `source`: 
	  - **BarStream:** platform identifier (e.g., “Tradovate”) 
	  - **EventStream:** writer (“U” for LIVE facts, “Paper” for SIM facts); platform identifier belongs in `payload`) 
  - platform timestamps preserved (plus receive time if available)

### 4.3 Intent + authority boundaries
- PA **MUST execute only OE-approved intents.**
- PA **MUST NOT accept intents** from any module other than OE.
- PA **MUST NOT push unsolicited execution outcomes directly to OE** (facts flow via U→Paper→OE).  
  PA **MAY** return synchronous receipt-acks and immediate failures to OE on the command call.

### 4.4 Backpressure boundaries (local to PA)
- If PA cannot deliver to U due to internal backpressure:
  - PA **MUST drop/summarize telemetry first** (logs, optional metrics).
  - PA **MUST NOT silently lose canonical-relevant events** without escalating a halt condition upstream (OE).
  - PA **MUST surface a “PA_DEGRADED / PA_DOWN” signal** to OE (exact message form: DISCOVERY REQUIRED, but the behavior is required).

---

## 5) Seq semantics (DECIDED CONTRACT)

### 5.1 BarStream `seq` (canonical field, assignment rule)
**Contract:**
- `seq` is **monotonic + contiguous per Stream Partition**:
  - Stream Partition = **(symbol, timeframe, session_day)**
  - `session_day` is derived deterministically from `bar_ts` using the instrument’s exchange timezone/calendar.

**Assignment:**
- If Tradovate supplies a suitable per-session monotonic sequence for bars: PA **MUST map/copy** it into `seq` unchanged (forward it to U).
- If Tradovate does not: PA **MUST NOT invent** bar `seq`; U assigns `seq` as bars are accepted/written.

### 5.2 EventStream `seq` (canonical field)
- EventStream canonical `seq` is **assigned by U** and is monotonic + contiguous per **(mode, source)**.
- PA may carry platform-native IDs in payload, but those are **not** canonical `seq`.

---

## 6) Canonical schemas (reference only; do not edit here)

### 6.1 OHLCV Bar schema (canonical BarStream written by U)
```
symbol
timeframe
bar_ts (aligned, deterministic)
open
high
low
close
volume
seq
mode (LIVE | SIM)
source (platform identifier)
```

### 6.2 Event schema (canonical EventStream written by U/Paper)
```
event_id
event_ts
mode (LIVE | SIM)
source (U | Paper)
event_type
payload (opaque, normalized; include platform identifier such as "platform":"Tradovate")
seq
```

---

# 7) DEV SOW ADDENDUM — Tradovate PA MVP (Discovery + Deliverables + Acceptance)

## Glossary 
**MIC (Module Interface Contract):** the binding contract for a module’s interfaces and invariants (allowed connections, message schemas/fields, ordering/seq expectations, and required failure/backpressure behavior)

## 7.1 Scope summary (what the dev is responsible for)
Build the Tradovate PA MVP implementation that:
- Connects/authenticates to Tradovate 
- Streams market updates (bars or ticks) and forwards them to U
- Receives OE execution intents and executes them on Tradovate
- Returns receipt-ack / immediate-failure response to OE on the command call
- Listens for execution/account events and forwards all facts to U (for canonical EventStream persistence)
- Produces a discovery report answering the unknowns listed below

## 7.2 Discovery Required (must research + report back)
**Market data capabilities (Tradovate):**
- What market data types are available: **ticks vs bars**  
- What bar intervals are available natively: **1s / 15s / 30s / 1m / custom**  
- Are bars “true bars” or server-side aggregates? Any known caveats?
- Delivery semantics: ordering, duplicates, reconnect replay, snapshot vs streaming

**Sequence IDs & identifiers:**
- Do market data messages include a stable **sequence ID**? If yes: scope (per symbol? per session? global?) and reset behavior.
- Do execution/account events include a stable **sequence ID** or event ID? If yes: semantics.
- What identifiers exist for:
  - account / subaccount (if any)
  - orders (client order id vs broker order id)
  - fills/executions
  - positions

**Reliability constraints:**
- Rate limits, throttle policies, and subscription limits
- Reconnect behavior and how to resume without missing data
- Heartbeat/keepalive requirements and timeouts

## 7.3 Deliverables (what must be handed back)
1) **PA Tradovate MVP implementation** (repo PRs)
2) **Config + secrets handling** for local + staging (no hardcoded creds)
3) **Runbook-lite**: how to run, how to test reconnect, where logs go
4) **Discovery report** (answers in 7.2, with citations/screenshots/links where possible)
5) **Test harness / mocks** sufficient to validate message shapes and ordering without a live account (as feasible)

## 7.4 Acceptance tests (minimum bar to call MVP “done”)

### A) Connectivity
- Can connect + authenticate reliably
- Detects disconnects and attempts reconnect with bounded backoff
- Reports “PA_DEGRADED/PA_DOWN” to OE when connection is not healthy

### B) Market data forwarding
- Subscribes to configured instruments
- Forwards:
  - bars if available (no fabricated bars)
  - else ticks (no aggregation into canonical bars inside PA unless explicitly approved later)
- Demonstrates correct timestamp handling (platform ts preserved; receive ts logged if available)

### C) Seq compliance (per contract)
- If platform provides bar seq with acceptable semantics: PA forwards it unchanged
- If not: PA leaves bar seq unmapped and documents it; U will assign
- Documents any duplicate/replay behavior observed during reconnect tests

### D) Execution path
- Receives intents from OE and executes them
- Returns **receipt-ack + immediate-failure** response to OE (platform request id if available)
- Emits all execution/account facts to U for canonical EventStream persistence (payload preserves raw platform fields)
- Demonstrates OE receives execution outcomes via **U → Paper → OE** (not via PA push)

### E) Failure behavior (the “don’t blow up the audit trail” test)
- Under simulated backpressure (slow consumer / blocked channel), PA:
  - sheds optional telemetry first
  - escalates to OE when canonical-relevant forwarding is at risk
  - does not silently drop canonical-relevant events

---

## 8) Known open contract items (do NOT guess; report/propose)
- Exact transport semantics PA↔U and OE↔PA (queue? stream? ack rules?)
- Timing expectations (latency windows, ack deadlines)
- Canonical persistence file layout and rollover rules (owned by U; PA should not implement)
- Hard thresholds for backlog-based trading halt (owned by OE/R policy; PA must comply)

---

## 9) Out of scope (explicit)
- Any strategy logic, indicator math, or trigger-zone math
- Any risk gating logic beyond relaying OE/R commands
- Any persistence implementation for canonical streams
- Any schema changes (new fields/columns) without Architecture/ADR update

___
**End of Draft v0.2**
